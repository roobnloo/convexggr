```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("data_generation.R")
source("cggr.R")
source("test_utils.R")
```

# Generate Data
```{r}
set.seed(100)
n <- 200
p <- 10
q <- 20
dim <- (p - 1) * (q + 1)
# load("data/tB.RData")
mG <- generate_mg(p, q)
tB <- generate_tb(p, q, 0.02)
s <- data_generate(n, p, q, tB, mG)
```

# Run
```{r}
result <- cggr(s$X, s$U, asparse = 0.75)
```

```{r}
print(gamma_viz_compare(result$ghat, mG))
```

### Compare sparsegl component matrices
```{r compare components}
for (i in seq_len(p + 1)) {
  cov_lbl <- paste0("component ", i)
  print(beta_viz_compare(result$bhat[,,i], tB[,,i], cov_lbl, tileborder = T))
}
```

```{r}
tpr <- sum(result$bhat != 0 & tB != 0) / sum(tB != 0)
fpr <- sum(result$bhat != 0 & tB == 0) / sum(tB == 0)
print(paste("TPR:", tpr))
print(paste("FPR:", fpr))
```

