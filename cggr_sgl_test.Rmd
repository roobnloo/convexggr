---
title: "Untitled"
author: "Robin Liu"
date: '2022-07-28'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("generate_data.R")
source("cggr_sgl.R")
source("test_utils.R")
library(rTensor)
```

```{r}
set.seed(103)
d <- 25 
p <- 50
n <- 200
s <- generate_data(n, d, p, ve = 0.01, sg = 0, reparametrize = F)
```

```{r}
sgl_result <- cggr_sgl(s$responses, s$covariates, 0.75, reparametrize = F)
```

### Compare component matrices
```{r compare components}
compute_idx <- c(1, 1 + s$cov_nz_idx)
for (i in seq_along(s$b_mxs)) {
  cov_lbl <- paste0("component ", compute_idx[i] - 1)
  print(beta_viz_compare(sgl_result$beta_mxs[[compute_idx[i]]],
                         s$b_mxs[[i]], cov_lbl))
}
```

```{r}
print(paste("TPR:", true_pos_rate(sgl_result$beta_mxs, s$b_mxs, s$cov_nz_idx)))
print(paste("FPR:", round(1-true_neg_rate(sgl_result$beta_mxs, s$b_mxs, s$cov_nz_idx), 3)))
```



```{r beta_plots}
for (b_mx in sgl_result$beta_mx) {
  print(beta_viz(b_mx))
}
```
